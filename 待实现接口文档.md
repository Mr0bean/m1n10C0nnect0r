# AI资讯平台 - 待实现接口文档

## 📋 概述

本文档详细列出了AI资讯平台中需要新开发的接口，共计 **5个接口** 分布在3个主要功能模块中。这些接口是在现有可复用接口基础上，为完善平台功能而需要额外开发的核心功能。

## 🎭 MOCK数据开发策略

> **重要说明**: 所有用户相关接口均采用MOCK数据进行前端开发，确保前端功能完整实现后再对接真实后端API。

### MOCK数据优势
- ✅ **并行开发**: 前端无需等待后端接口完成
- ✅ **功能验证**: 提前验证用户交互流程
- ✅ **数据一致**: 统一的测试数据便于调试
- ✅ **快速迭代**: 前端可独立进行UI/UX优化

### MOCK数据规范
- 🔧 **文件组织**: 统一放置在 `mock/` 目录下
- 🔧 **命名规范**: 使用 `mock_` 前缀标识测试数据
- 🔧 **数据真实**: 模拟真实业务场景的数据结构
- 🔧 **状态管理**: 支持交互操作的状态变更

### 📊 待实现接口统计

| 功能模块 | 待实现接口数 | 优先级 | 预估工期 |
|---------|-------------|--------|----------|
| 用户认证 | 1 | 🔥 高 | 3天 |
| 用户交互 | 1 | ⚡ 中 | 2天 |
| 评论系统 | 3 | ⚡ 中 | 5天 |
| **总计** | **5** | - | **10天** |

---

## 🔥 高优先级接口（阻塞性功能）

### 1. 用户认证系统

#### 1.1 获取用户信息 🎭 MOCK数据
**🔴 待实现**

> **📝 开发说明**: 此接口使用MOCK数据进行前端开发，后期替换为真实API

```http
GET /api/v1/auth/profile
```

**功能描述**:
- 获取当前登录用户的详细信息
- 支持JWT Token认证
- 返回用户基本信息、会员状态等

**请求头**:
```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**MOCK响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "mock_user_12345",
    "username": "张三",
    "email": "zhangsan@thinkin.ai",
    "avatar": "https://api.dicebear.com/7.x/avataaars/svg?seed=张三",
    "membership": {
      "type": "premium",
      "expireTime": "2024-12-31T23:59:59Z",
      "badge": "高级会员"
    },
    "joinTime": "2023-01-15T10:30:00Z",
    "lastLoginTime": "2024-01-15T09:00:00Z",
    "preferences": {
      "theme": "dark",
      "language": "zh-CN",
      "notifications": true
    }
  }
}
```

**前端MOCK实现**:
```javascript
// mock/user.js
export const mockUserProfile = {
  code: 200,
  message: "success",
  data: {
    id: "mock_user_12345",
    username: "张三",
    email: "zhangsan@thinkin.ai",
    avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=张三",
    membership: {
      type: "premium",
      expireTime: "2024-12-31T23:59:59Z",
      badge: "高级会员"
    },
    joinTime: "2023-01-15T10:30:00Z",
    lastLoginTime: "2024-01-15T09:00:00Z",
    preferences: {
      theme: "dark",
      language: "zh-CN",
      notifications: true
    }
  }
};
```

**开发要点**:
- [ ] JWT Token验证中间件
- [ ] 用户信息数据模型设计
- [ ] 会员状态管理逻辑
- [ ] 错误处理和安全验证

**依赖关系**:
- 阻塞其他需要用户认证的接口
- 前端用户状态管理的基础

---

## ⚡ 中优先级接口（核心功能）

### 2. 用户交互功能

#### 2.1 文章点赞/取消点赞 🎭 MOCK数据
**🔴 待实现**

> **📝 开发说明**: 此接口使用MOCK数据进行前端开发，后期替换为真实API

```http
POST /api/v1/articles/{article_id}/like
```

**功能描述**:
- 用户对文章进行点赞或取消点赞操作
- 实时更新点赞数量
- 记录用户点赞行为

**路径参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `article_id` | string | 是 | 文章ID |

**请求头**:
```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**请求体**:
```json
{
  "action": "like"  // "like" | "unlike"
}
```

**MOCK响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "articleId": "article_123",
    "isLiked": true,
    "likeCount": 90,
    "userId": "mock_user_12345",
    "timestamp": "2024-01-15T16:45:00Z"
  }
}
```

**前端MOCK实现**:
```javascript
// mock/articles.js
let mockLikeData = {
  "article_123": { isLiked: false, likeCount: 89 },
  "article_456": { isLiked: true, likeCount: 156 }
};

export const mockArticleLike = (articleId, action) => {
  const current = mockLikeData[articleId] || { isLiked: false, likeCount: 0 };
  
  if (action === 'like' && !current.isLiked) {
    current.isLiked = true;
    current.likeCount += 1;
  } else if (action === 'unlike' && current.isLiked) {
    current.isLiked = false;
    current.likeCount -= 1;
  }
  
  mockLikeData[articleId] = current;
  
  return {
    code: 200,
    message: "操作成功",
    data: {
      articleId: articleId,
      isLiked: current.isLiked,
      likeCount: current.likeCount,
      userId: "mock_user_12345",
      timestamp: new Date().toISOString()
    }
  };
};
```

**开发要点**:
- [ ] 点赞状态数据表设计
- [ ] 防重复点赞逻辑
- [ ] 点赞数量实时更新
- [ ] 用户行为记录集成

---

### 3. 评论系统

#### 3.1 获取评论列表 🎭 MOCK数据
**🔴 待实现**

> **📝 开发说明**: 此接口使用MOCK数据进行前端开发，后期替换为真实API

```http
GET /api/v1/articles/{article_id}/comments
```

**功能描述**:
- 获取指定文章的评论列表
- 支持分页和排序
- 支持嵌套回复显示

**路径参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `article_id` | string | 是 | 文章ID |

**查询参数**:
| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| `page` | int | 否 | 1 | 页码 |
| `pageSize` | int | 否 | 10 | 每页数量 |
| `sortBy` | string | 否 | latest | 排序方式 |
| `parentId` | string | 否 | - | 父评论ID (获取回复) |

**排序枚举**:
- `latest`: 最新评论
- `popular`: 热门评论
- `oldest`: 最早评论

**MOCK响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 23,
    "page": 1,
    "pageSize": 10,
    "hasNext": true,
    "comments": [
      {
        "id": "mock_comment_001",
        "content": "这篇文章写得很好，对多智能体协作的分析很深入！",
        "author": {
          "id": "mock_user_001",
          "name": "李四",
          "avatar": "https://api.dicebear.com/7.x/avataaars/svg?seed=李四",
          "level": "高级会员"
        },
        "createTime": "2024-01-15T17:30:00Z",
        "updateTime": null,
        "likeCount": 5,
        "replyCount": 2,
        "isLiked": false,
        "isAuthor": false,
        "status": "published",
        "replies": [
          {
            "id": "mock_reply_001",
            "content": "同感，期待更多这样的深度分析",
            "author": {
              "id": "mock_user_002",
              "name": "王五",
              "avatar": "https://api.dicebear.com/7.x/avataaars/svg?seed=王五"
            },
            "createTime": "2024-01-15T18:00:00Z",
            "likeCount": 2,
            "isLiked": true
          }
        ]
      }
    ]
  }
}
```

**前端MOCK实现**:
```javascript
// mock/comments.js
export const mockComments = {
  "article_123": [
    {
      id: "mock_comment_001",
      content: "这篇文章写得很好，对多智能体协作的分析很深入！",
      author: {
        id: "mock_user_001",
        name: "李四",
        avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=李四",
        level: "高级会员"
      },
      createTime: "2024-01-15T17:30:00Z",
      updateTime: null,
      likeCount: 5,
      replyCount: 2,
      isLiked: false,
      isAuthor: false,
      status: "published",
      replies: [
        {
          id: "mock_reply_001",
          content: "同感，期待更多这样的深度分析",
          author: {
            id: "mock_user_002",
            name: "王五",
            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=王五"
          },
          createTime: "2024-01-15T18:00:00Z",
          likeCount: 2,
          isLiked: true
        }
      ]
    }
  ]
};

export const mockGetComments = (articleId, page = 1, pageSize = 10) => {
  const comments = mockComments[articleId] || [];
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  
  return {
    code: 200,
    message: "success",
    data: {
      total: comments.length,
      page,
      pageSize,
      hasNext: end < comments.length,
      comments: comments.slice(start, end)
    }
  };
};
```

**开发要点**:
- [ ] 评论数据表设计（支持嵌套回复）
- [ ] 分页查询优化
- [ ] 评论状态管理（发布/审核/删除）
- [ ] 用户权限验证（作者标识）

#### 3.2 发表评论 🎭 MOCK数据
**🔴 待实现**

> **📝 开发说明**: 此接口使用MOCK数据进行前端开发，后期替换为真实API

```http
POST /api/v1/articles/{article_id}/comments
```

**功能描述**:
- 用户发表新评论或回复
- 支持@用户功能
- 评论内容安全过滤

**路径参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `article_id` | string | 是 | 文章ID |

**请求头**:
```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**请求体**:
```json
{
  "content": "这篇文章写得很好！",
  "parentId": null,  // 回复评论时填写父评论ID
  "mentions": ["user_123"]  // @用户功能
}
```

**MOCK响应示例**:
```json
{
  "code": 200,
  "message": "评论发表成功",
  "data": {
    "id": "mock_comment_002",
    "content": "这篇文章写得很好！",
    "author": {
      "id": "mock_user_12345",
      "name": "张三",
      "avatar": "https://api.dicebear.com/7.x/avataaars/svg?seed=张三"
    },
    "createTime": "2024-01-15T19:00:00Z",
    "likeCount": 0,
    "replyCount": 0,
    "isLiked": false,
    "status": "published",
    "parentId": null,
    "mentions": []
  }
}
```

**前端MOCK实现**:
```javascript
// mock/comments.js
export const mockPostComment = (articleId, commentData) => {
  const newComment = {
    id: `mock_comment_${Date.now()}`,
    content: commentData.content,
    author: {
      id: "mock_user_12345",
      name: "张三",
      avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=张三"
    },
    createTime: new Date().toISOString(),
    likeCount: 0,
    replyCount: 0,
    isLiked: false,
    status: "published",
    parentId: commentData.parentId || null,
    mentions: commentData.mentions || [],
    replies: []
  };
  
  // 添加到mock数据中
  if (!mockComments[articleId]) {
    mockComments[articleId] = [];
  }
  
  if (commentData.parentId) {
    // 如果是回复，添加到对应评论的replies中
    const parentComment = mockComments[articleId].find(c => c.id === commentData.parentId);
    if (parentComment) {
      parentComment.replies.push(newComment);
      parentComment.replyCount += 1;
    }
  } else {
    // 如果是主评论，直接添加
    mockComments[articleId].unshift(newComment);
  }
  
  return {
    code: 200,
    message: "评论发表成功",
    data: newComment
  };
};
```

**开发要点**:
- [ ] 评论内容验证和过滤
- [ ] @用户提醒功能
- [ ] 评论审核机制
- [ ] 防刷评论限制

#### 3.3 评论点赞 🎭 MOCK数据
**🔴 待实现**

> **📝 开发说明**: 此接口使用MOCK数据进行前端开发，后期替换为真实API

```http
POST /api/v1/comments/{comment_id}/like
```

**功能描述**:
- 用户对评论进行点赞或取消点赞
- 实时更新评论点赞数

**路径参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `comment_id` | string | 是 | 评论ID |

**请求头**:
```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**请求体**:
```json
{
  "action": "like"  // "like" | "unlike"
}
```

**MOCK响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "commentId": "mock_comment_001",
    "isLiked": true,
    "likeCount": 6,
    "userId": "mock_user_12345",
    "timestamp": "2024-01-15T19:15:00Z"
  }
}
```

**前端MOCK实现**:
```javascript
// mock/comments.js
let mockCommentLikes = {
  "mock_comment_001": { isLiked: false, likeCount: 5 },
  "mock_reply_001": { isLiked: true, likeCount: 2 }
};

export const mockCommentLike = (commentId, action) => {
  const current = mockCommentLikes[commentId] || { isLiked: false, likeCount: 0 };
  
  if (action === 'like' && !current.isLiked) {
    current.isLiked = true;
    current.likeCount += 1;
  } else if (action === 'unlike' && current.isLiked) {
    current.isLiked = false;
    current.likeCount -= 1;
  }
  
  mockCommentLikes[commentId] = current;
  
  // 同时更新mockComments中的数据
  Object.values(mockComments).forEach(articleComments => {
    articleComments.forEach(comment => {
      if (comment.id === commentId) {
        comment.isLiked = current.isLiked;
        comment.likeCount = current.likeCount;
      }
      comment.replies?.forEach(reply => {
        if (reply.id === commentId) {
          reply.isLiked = current.isLiked;
          reply.likeCount = current.likeCount;
        }
      });
    });
  });
  
  return {
    code: 200,
    message: "操作成功",
    data: {
      commentId: commentId,
      isLiked: current.isLiked,
      likeCount: current.likeCount,
      userId: "mock_user_12345",
      timestamp: new Date().toISOString()
    }
  };
};
```

**开发要点**:
- [ ] 评论点赞状态管理
- [ ] 防重复点赞逻辑
- [ ] 点赞数量统计

---

## 🛠️ 技术实现要求

### 数据库设计

#### 用户表 (users)
```sql
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE,
  avatar VARCHAR(255),
  membership_type ENUM('free', 'basic', 'premium') DEFAULT 'free',
  membership_expire_time DATETIME,
  join_time DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_login_time DATETIME,
  status ENUM('active', 'inactive', 'banned') DEFAULT 'active',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 文章点赞表 (article_likes)
```sql
CREATE TABLE article_likes (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  article_id VARCHAR(50) NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY uk_user_article (user_id, article_id),
  INDEX idx_article_id (article_id)
);
```

#### 评论表 (comments)
```sql
CREATE TABLE comments (
  id VARCHAR(50) PRIMARY KEY,
  article_id VARCHAR(50) NOT NULL,
  user_id BIGINT NOT NULL,
  parent_id VARCHAR(50) NULL,
  content TEXT NOT NULL,
  like_count INT DEFAULT 0,
  reply_count INT DEFAULT 0,
  status ENUM('published', 'pending', 'deleted') DEFAULT 'published',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_article_id (article_id),
  INDEX idx_user_id (user_id),
  INDEX idx_parent_id (parent_id)
);
```

#### 评论点赞表 (comment_likes)
```sql
CREATE TABLE comment_likes (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  comment_id VARCHAR(50) NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY uk_user_comment (user_id, comment_id),
  INDEX idx_comment_id (comment_id)
);
```

### 安全要求

#### JWT Token验证
- Token有效期：24小时
- 刷新Token有效期：7天
- 密钥轮转机制
- Token黑名单管理

#### 内容安全
- 评论内容XSS过滤
- 敏感词汇检测
- 垃圾评论识别
- 频率限制机制

### 性能要求

#### 缓存策略
- 用户信息缓存：30分钟
- 评论列表缓存：2分钟
- 点赞状态缓存：5分钟

#### 限流规则
- 评论发表：10次/分钟
- 点赞操作：30次/分钟
- 用户信息查询：100次/分钟

---

## 📋 开发任务分解

### 🎭 第一阶段：MOCK数据前端开发（2天）

**Day 1: MOCK数据架构**
- [ ] 创建统一的MOCK数据文件结构
- [ ] 实现用户认证MOCK接口
- [ ] 实现文章点赞MOCK功能

**Day 2: 评论系统MOCK**
- [ ] 实现评论系统MOCK接口
- [ ] 前端交互功能完整测试
- [ ] MOCK数据状态管理验证

### 🔧 第二阶段：用户认证系统（3天）

**Day 1: 基础架构**
- [ ] JWT中间件开发
- [ ] 用户数据模型设计
- [ ] 数据库表创建

**Day 2: 核心功能**
- [ ] 用户信息真实接口开发
- [ ] 会员状态管理
- [ ] 单元测试编写

**Day 3: 集成测试**
- [ ] 接口联调测试
- [ ] 安全性测试
- [ ] 替换用户认证MOCK数据

### ⚡ 第三阶段：用户交互功能（2天）

**Day 1: 点赞功能**
- [ ] 点赞数据模型设计
- [ ] 点赞真实接口开发
- [ ] 防重复点赞逻辑

**Day 2: 测试优化**
- [ ] 功能测试
- [ ] 性能测试
- [ ] 替换点赞功能MOCK数据

### 💬 第四阶段：评论系统（5天）

**Day 1-2: 数据模型**
- [ ] 评论表设计
- [ ] 嵌套回复结构
- [ ] 索引优化

**Day 3-4: 核心功能**
- [ ] 评论CRUD真实接口
- [ ] 评论点赞真实功能
- [ ] @用户功能

**Day 5: 安全与测试**
- [ ] 内容安全过滤
- [ ] 评论审核机制
- [ ] 替换评论系统MOCK数据

### 🔄 第五阶段：接口对接与优化（1天）

**Day 1: 最终对接**
- [ ] 前端API调用切换配置
- [ ] 真实接口联调测试
- [ ] 性能优化和错误处理
- [ ] 移除MOCK数据代码

---

## 🧪 测试用例

### 用户认证测试

```javascript
// 测试用例：获取用户信息
describe('GET /api/v1/auth/profile', () => {
  it('应该返回用户信息当Token有效时', async () => {
    const response = await request(app)
      .get('/api/v1/auth/profile')
      .set('Authorization', 'Bearer valid_token')
      .expect(200);
    
    expect(response.body.data).toHaveProperty('id');
    expect(response.body.data).toHaveProperty('username');
    expect(response.body.data).toHaveProperty('membership');
  });
  
  it('应该返回401当Token无效时', async () => {
    await request(app)
      .get('/api/v1/auth/profile')
      .set('Authorization', 'Bearer invalid_token')
      .expect(401);
  });
});
```

### 点赞功能测试

```javascript
// 测试用例：文章点赞
describe('POST /api/v1/articles/:id/like', () => {
  it('应该成功点赞文章', async () => {
    const response = await request(app)
      .post('/api/v1/articles/article_001/like')
      .set('Authorization', 'Bearer valid_token')
      .send({ action: 'like' })
      .expect(200);
    
    expect(response.body.data.isLiked).toBe(true);
    expect(response.body.data.likeCount).toBeGreaterThan(0);
  });
  
  it('应该防止重复点赞', async () => {
    // 第一次点赞
    await request(app)
      .post('/api/v1/articles/article_001/like')
      .set('Authorization', 'Bearer valid_token')
      .send({ action: 'like' });
    
    // 第二次点赞应该无效果
    const response = await request(app)
      .post('/api/v1/articles/article_001/like')
      .set('Authorization', 'Bearer valid_token')
      .send({ action: 'like' })
      .expect(200);
    
    expect(response.body.data.isLiked).toBe(true);
  });
});
```

### 评论功能测试

```javascript
// 测试用例：发表评论
describe('POST /api/v1/articles/:id/comments', () => {
  it('应该成功发表评论', async () => {
    const response = await request(app)
      .post('/api/v1/articles/article_001/comments')
      .set('Authorization', 'Bearer valid_token')
      .send({
        content: '这是一条测试评论',
        parentId: null
      })
      .expect(200);
    
    expect(response.body.data).toHaveProperty('id');
    expect(response.body.data.content).toBe('这是一条测试评论');
  });
  
  it('应该拒绝空内容评论', async () => {
    await request(app)
      .post('/api/v1/articles/article_001/comments')
      .set('Authorization', 'Bearer valid_token')
      .send({ content: '' })
      .expect(400);
  });
});
```

---

## 📚 参考资料

### 技术文档
- [JWT官方文档](https://jwt.io/)
- [Express.js安全最佳实践](https://expressjs.com/en/advanced/best-practice-security.html)
- [MySQL索引优化指南](https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html)

### 代码规范
- [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript)
- [RESTful API设计规范](https://restfulapi.net/)
- [HTTP状态码使用指南](https://httpstatuses.com/)

---

## 📞 联系方式

- **开发负责人**: 后端开发团队
- **技术支持**: API开发小组
- **问题反馈**: [项目Issues](https://github.com/your-org/newsletter-api/issues)
- **开发讨论**: [开发者群组](https://your-org.slack.com/channels/backend-dev)

---

**文档版本**: v1.0  
**创建时间**: 2024-01-15  
**预计完成**: 2024-01-25